function viz(t){function e(t,e){return x[t.index+","+e.index]}function r(){var t=d3.select(this).node().__data__.id;if(0==y||h!=t){d=d3.select(this).node().__data__,f.style("opacity",function(t){return e(d,t)?1:.1}),s.style("opacity",function(t){return d.index==t.source.index?1:.1}),y=1;var r=d.id;h=r,$(".link-label").attr("opacity",.1),$(".link-label[source="+r+"]").attr("opacity",1)}else f.style("opacity",1),s.style("opacity",1),y=0,$(".link-label").attr("opacity",1)}d3.select("svg").remove();var n=height=800,a=d3.select("#viz-base").append("svg").attr("width",n).attr("height",height),c=t.nodes,l=t.links,o=d3.layout.force().size([n,height]).nodes(c).links(l);o.charge(-2e4).gravity(1).linkDistance(256).linkStrength(1).friction(.4),a.append("defs").selectAll("marker").data(["end"]).enter().append("marker").attr("id",function(t){return t}).attr("viewBox","0 -5 10 10").attr("refX",32).attr("refY",0).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5 L10,0 L0, -5").style("stroke","#4679BD").style("stroke-width","0.2em");var s=a.selectAll(".link").data(l).enter().insert("g").attr("class","link").insert("line").style("marker-end","url(#end)").attr("class","link-line").attr("x1",function(t){return c[t.source].x}).attr("y1",function(t){return c[t.source].y}).attr("x2",function(t){return c[t.target].x}).attr("y2",function(t){return c[t.target].y}),u=a.selectAll(".link").insert("svg:text").attr("class","link-label").attr("source",function(t){return t.source}).text(function(t){return t.weight}),f=a.selectAll("g.node").data(c,function(t){return t.id}),g=f.enter().append("g").attr("class","node").call(o.drag).on("dblclick",r);g.insert("svg:circle").attr("r","1em"),g.insert("svg:text").attr("class","node-text").attr("text-anchor","middle").attr("y","0.4em").text(function(t){return t.id}),o.on("tick",function(){f.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),s.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),u.attr("x",function(t){var e=Math.abs(t.source.x-t.target.x),r=t.target.x>t.source.x;return r?t.target.x-e/weight_label_coeff:t.target.x+e/weight_label_coeff}).attr("y",function(t){var e=Math.abs(t.source.y-t.target.y),r=t.target.y>t.source.y;return r?t.target.y-e/weight_label_coeff:t.target.y+e/weight_label_coeff})}),o.start();var y=0,h=null,x={};for(i=0;i<t.nodes.length;i++)x[i+","+i]=1;t.links.forEach(function(t){x[t.source.index+","+t.target.index]=1})}var weight_label_coeff=5,weight_diff_coeff=180;